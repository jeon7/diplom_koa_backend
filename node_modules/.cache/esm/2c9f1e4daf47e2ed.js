let mongoose,User;_af4‍.x([["list",()=>list],["add",()=>add],["remove",()=>remove]]);_af4‍.w("mongoose",[["default",["mongoose"],function(v){mongoose=v}]]);_af4‍.w("../../models/user",[["default",["User"],function(v){User=v}]]);


const { ObjectId } = mongoose.Types;

/*
  GET /api/bookmarks
*/
       const list = async ctx => {
  const { user } = ctx.state;
  try {
    // populate
    const result = await User.findOne({ _id: user._id }).populate('bookmarkedNoteIds');
    ctx.body = result.bookmarkedNoteIds;
  } catch (e) {
    ctx.throw(500, e);
  }
};

/*
  PATCH /api/bookmarks/add/:id
*/
       const add = async ctx => {
  const { id } = ctx.params;

  if (!ObjectId.isValid(id)) {
    ctx.status = 400; // Bad Request
    return;
  }

  try {
    const { user } = ctx.state;
    const userModel = await User.findById(user._id);
    await userModel.addBookmark(id);
    ctx.body = userModel;

  } catch (e) {
    ctx.throw(500, e);
  }
};

/*
  PATCH /api/bookmarks/remove/:id
*/
       const remove = async ctx => {
  const { id } = ctx.params;
  if (!ObjectId.isValid(id)) {
    ctx.status = 400; // Bad Request
    return;
  }

  try {
    const { user } = ctx.state;
    const userModel = await User.findById(user._id);
    await userModel.removeBookmark(id);
    ctx.body = userModel;

  } catch (e) {
    ctx.throw(500, e);
  }
};